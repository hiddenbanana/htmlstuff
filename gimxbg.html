<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Glitch Video Background + Centered Logo (Auto-Cycle)</title>
  <style>
    body, html { margin:0; padding:0; height:100%; overflow:hidden; }
    #bg-video {
      position: fixed;
      top: 50%; left: 50%;
      min-width: 100%; min-height: 100%;
      width: auto; height: auto;
      transform: translate(-50%, -50%);
      z-index: -1;
      object-fit: cover;
    }
    #logo-container {
      position: fixed;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      z-index: 1;
      pointer-events: none;
    }
    #logo {
      max-width: 300px;
      width: 100%;
      height: auto;
    }
    #new-video {
      position: fixed;
      bottom: 20px; right: 20px;
      z-index: 2;
      padding: 10px 18px;
      font-family: sans-serif;
      font-weight: bold;
      background: rgba(0,0,0,0.5);
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    #new-video:hover { background: rgba(0,0,0,0.7); }
  </style>
</head>
<body>

  <video id="bg-video" autoplay muted playsinline></video>

  <div id="logo-container">
    <img id="logo" src="https://github.com/hiddenbanana/htmlstuff/blob/main/GIMX-LOGO-white.png?raw=true" alt="Logo">
  </div>

  <button id="new-video">Next Video</button>

  <script>
    const API_KEY = 'ZF8qy3fNZlH3TCELlBKW9uK3fnFDZsvk6ZozOgXiGvIARDWd6q1EL4ha';
    const SEARCH_QUERY = 'glitch';  // Updated to "glitch" for glitchy videos
    const VIDEO_ELEMENT = document.getElementById('bg-video');
    const NEW_BTN = document.getElementById('new-video');

    let videoCache = []; // Store fetched videos to avoid repeats
    let usedVideos = new Set(); // Track used video IDs

    // Fetch a batch of videos (30 at a time)
    async function fetchVideoBatch() {
      try {
        const resp = await fetch(
          `https://api.pexels.com/videos/search?query=${SEARCH_QUERY}&per_page=30`,
          { headers: { Authorization: API_KEY } }
        );
        if (!resp.ok) throw new Error(`Pexels error: ${resp.status}`);
        const data = await resp.json();
        return data.videos || [];
      } catch (e) {
        console.error(e);
        return [];
      }
    }

    // Get a random unused video
    function getRandomVideo() {
      const available = videoCache.filter(v => !usedVideos.has(v.id));
      if (available.length === 0) {
        // Refill cache if all used
        usedVideos.clear();
        return getRandomVideo();
      }
      const vid = available[Math.floor(Math.random() * available.length)];
      usedVideos.add(vid.id);
      return vid;
    }

    // Load and play a new random video
    async function loadNextVideo() {
      if (videoCache.length < 5) {
        const newBatch = await fetchVideoBatch();
        videoCache.push(...newBatch);
      }

      const vid = getRandomVideo();
      if (!vid) {
        console.error("No video available");
        return;
      }

      const file = vid.video_files.slice(-1)[0].link; // highest quality
      VIDEO_ELEMENT.src = file;
      VIDEO_ELEMENT.load();
      VIDEO_ELEMENT.play().catch(() => {});
    }

    // Auto-cycle: load next when current ends
    VIDEO_ELEMENT.addEventListener('ended', loadNextVideo);

    // Button: skip to next
    NEW_BTN.addEventListener('click', loadNextVideo);

    // Start the cycle
    loadNextVideo();
  </script>

  <noscript>
    <p>JavaScript is required to load videos.</p>
  </noscript>
</body>
</html>
