<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Glitch Video + Modal Controls</title>
  <style>
    body, html { margin:0; padding:0; height:100%; overflow:hidden; font-family: sans-serif; }
    #bg-video {
      position: fixed; top: 50%; left: 50%; min-width: 100%; min-height: 100%;
      width: auto; height: auto; transform: translate(-50%, -50%);
      z-index: -1; object-fit: cover;
    }
    #logo-container {
      position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
      z-index: 1; pointer-events: none;
    }
    #logo {
      max-width: 600px; width: 100%; height: auto;
      filter: drop-shadow(0 0 12px rgba(0,0,0,0.7));
    }

    /* Modal */
    #modal {
      position: fixed; top: 20px; left: 20px; z-index: 10;
      background: rgba(0,0,0,0.8); padding: 16px; border-radius: 12px;
      display: flex; gap: 10px; align-items: center; color: white;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5);
      transition: transform 0.3s ease, opacity 0.3s ease;
    }
    #modal.hidden { transform: translateY(-150%); opacity: 0; pointer-events: none; }
    #search-input {
      padding: 10px; font-size: 16px; border: 2px solid #fff; border-radius: 6px;
      background: rgba(255,255,255,0.1); color: white; width: 200px;
    }
    #search-btn, #next-btn {
      padding: 10px 16px; background: rgba(255,255,255,0.2); color: white;
      border: 2px solid #fff; border-radius: 6px; font-weight: bold; cursor: pointer;
    }
    #search-btn:hover, #next-btn:hover { background: rgba(255,255,255,0.4); }

    /* Toggle Button */
    #toggle-modal {
      position: fixed; top: 20px; left: 20px; z-index: 11;
      width: 50px; height: 50px; background: rgba(255,255,255,0.2);
      border: 2px solid #fff; border-radius: 50%; color: white;
      font-size: 24px; line-height: 46px; text-align: center;
      cursor: pointer; backdrop-filter: blur(4px);
      transition: all 0.3s ease;
    }
    #toggle-modal:hover { background: rgba(255,255,255,0.4); transform: scale(1.1); }
  </style>
</head>
<body>

  <video id="bg-video" autoplay muted playsinline></video>

  <div id="logo-container">
    <img id="logo" src="https://github.com/hiddenbanana/htmlstuff/blob/main/GIMX-LOGO-white.png?raw=true" alt="Logo">
  </div>

  <!-- TOGGLE BUTTON -->
  <div id="toggle-modal" title="Show Controls">Gear</div>

  <!-- MODAL (hidden by default) -->
  <div id="modal" class="hidden">
    <input id="search-input" type="text" placeholder="Search (e.g. cyberpunk)" />
    <button id="search-btn">Search</button>
    <button id="next-btn">Next Video</button>
  </div>

  <script>
    const API_KEY = 'ZF8qy3fNZlH3TCELlBKW9uK3fnFDZsvk6ZozOgXiGvIARDWd6q1EL4ha';
    const VIDEO_ELEMENT = document.getElementById('bg-video');
    const SEARCH_INPUT = document.getElementById('search-input');
    const SEARCH_BTN = document.getElementById('search-btn');
    const NEXT_BTN = document.getElementById('next-btn');
    const MODAL = document.getElementById('modal');
    const TOGGLE = document.getElementById('toggle-modal');

    let videoCache = [];
    let usedVideos = new Set();
    let currentQuery = 'glitch';

    // Fetch videos
    async function fetchVideoBatch() {
      const query = currentQuery.trim() || 'glitch';
      try {
        const resp = await fetch(
          `https://api.pexels.com/videos/search?query=${encodeURIComponent(query)}&per_page=30`,
          { headers: { Authorization: API_KEY } }
        );
        if (!resp.ok) throw new Error(`Pexels error: ${resp.status}`);
        const data = await resp.json();
        return data.videos || [];
      } catch (e) {
        console.error(e);
        return [];
      }
    }

    function getRandomVideo() {
      const available = videoCache.filter(v => !usedVideos.has(v.id));
      if (available.length === 0) {
        usedVideos.clear();
        if (videoCache.length === 0) return null;
      }
      const vid = available.length 
        ? available[Math.floor(Math.random() * available.length)]
        : videoCache[Math.floor(Math.random() * videoCache.length)];
      usedVideos.add(vid.id);
      return vid;
    }

    async function loadNextVideo() {
      if (videoCache.length < 5) {
        const newBatch = await fetchVideoBatch();
        videoCache.push(...newBatch);
      }
      const vid = getRandomVideo();
      if (!vid) return;
      const file = vid.video_files.slice(-1)[0].link;
      VIDEO_ELEMENT.src = file;
      VIDEO_ELEMENT.load();
      VIDEO_ELEMENT.play().catch(() => {});
    }

    // Search
    function performSearch() {
      const input = SEARCH_INPUT.value.trim();
      currentQuery = input || 'glitch';
      videoCache = [];
      usedVideos.clear();
      loadNextVideo();
    }

    SEARCH_BTN.addEventListener('click', performSearch);
    SEARCH_INPUT.addEventListener('keypress', e => {
      if (e.key === 'Enter') performSearch();
    });

    // Modal toggle
    TOGGLE.addEventListener('click', () => {
      MODAL.classList.toggle('hidden');
      TOGGLE.textContent = MODAL.classList.contains('hidden') ? 'Gear' : 'Times';
    });

    // Auto-cycle + next
    VIDEO_ELEMENT.addEventListener('ended', loadNextVideo);
    NEXT_BTN.addEventListener('click', loadNextVideo);

    // Start
    loadNextVideo();
  </script>
</body>
</html>
